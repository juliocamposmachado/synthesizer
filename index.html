<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sintetizador + Bateria Virtual ‚Äî Demo</title>
  <style>
    :root{--bg:#0b1220;--card:#0f1724;--accent:#1fb6ff;--muted:#98a0b3}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;color:#e6eef8;background:linear-gradient(180deg,#071029 0%, #071b2f 100%)}
    .app{max-width:1400px;margin:28px auto;padding:18px;display:grid;grid-template-columns:450px 1fr;gap:18px}
    .card{background:rgba(255,255,255,0.03);border-radius:12px;padding:14px;box-shadow:0 6px 20px rgba(2,6,23,0.6)}
    h1{margin:6px 0 12px;font-size:18px}
    .pads{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:16px}
    .pad{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border:1px solid rgba(255,255,255,0.04);padding:10px;border-radius:8px;cursor:pointer;user-select:none;text-align:center;font-size:12px;font-weight:500;transition:all 0.1s ease}
    .pad:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.3)}
    .pad:active{transform:translateY(2px)}
    
    /* Drum pad colors */
    .pad-kick{background:linear-gradient(135deg,#ff4757,#ff3838);color:white;border:1px solid #ff3838}
    .pad-snare{background:linear-gradient(135deg,#ffa502,#ff6348);color:white;border:1px solid #ff6348}
    .pad-hat{background:linear-gradient(135deg,#70a1ff,#5352ed);color:white;border:1px solid #5352ed}
    .pad-crash{background:linear-gradient(135deg,#7bed9f,#2ed573);color:white;border:1px solid #2ed573}
    .pad-ride{background:linear-gradient(135deg,#dda0dd,#9b59b6);color:white;border:1px solid #9b59b6}
    .pad-tom{background:linear-gradient(135deg,#ffb8b8,#ff7675);color:white;border:1px solid #ff7675}
    .pad-openhat{background:linear-gradient(135deg,#74b9ff,#0984e3);color:white;border:1px solid #0984e3}
    .pad-clap{background:linear-gradient(135deg,#fd79a8,#e84393);color:white;border:1px solid #e84393}
    .pad-perc{background:linear-gradient(135deg,#fdcb6e,#e17055);color:white;border:1px solid #e17055}
    
    /* Melodic instrument colors */
    .pad-piano{background:linear-gradient(135deg,#636e72,#2d3436);color:white;border:1px solid #2d3436}
    .pad-bass{background:linear-gradient(135deg,#a29bfe,#6c5ce7);color:white;border:1px solid #6c5ce7}
    .pad-lead{background:linear-gradient(135deg,#fd79a8,#e84393);color:white;border:1px solid #e84393}
    .pad-pad{background:linear-gradient(135deg,#00cec9,#00b894);color:white;border:1px solid #00b894}
    .pad-pluck{background:linear-gradient(135deg,#fab1a0,#e17055);color:white;border:1px solid #e17055}
    .pad-organ{background:linear-gradient(135deg,#55a3ff,#2d3436);color:white;border:1px solid #2d3436}
    
    /* Effect colors */
    .pad-fx{background:linear-gradient(135deg,#a29bfe,#74b9ff);color:white;border:1px solid #74b9ff}
    .pad-noise{background:linear-gradient(135deg,#636e72,#2d3436);color:white;border:1px solid #2d3436}
    .pad-sweep{background:linear-gradient(135deg,#00b894,#00cec9);color:white;border:1px solid #00cec9}
    
    .center{display:flex;flex-direction:column;gap:12px}
    .pad-section{margin-bottom:20px}
    .section-title{font-size:14px;font-weight:600;margin-bottom:8px;color:#1fb6ff;text-transform:uppercase;letter-spacing:0.5px}
    #xyCanvas{width:100%;height:420px;background:linear-gradient(180deg,#071b2f,#04202a);border-radius:10px;touch-action:none}
    .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    label{font-size:12px;color:var(--muted)}
    input[type=range]{-webkit-appearance:none;height:6px;background:rgba(255,255,255,0.05);border-radius:6px}
    .row{display:flex;gap:8px;align-items:center}
    button{background:var(--accent);border:none;color:#022233;padding:8px 12px;border-radius:8px;cursor:pointer}
    .muted-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .meta{font-size:12px;color:var(--muted)}
    .preset-list{display:flex;gap:8px;flex-wrap:wrap}
    .preset{background:rgba(255,255,255,0.02);padding:6px 8px;border-radius:6px;border:1px solid rgba(255,255,255,0.03);cursor:pointer}
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <h1>Sintetizador + Bateria Virtual</h1>
      <div class="meta">Toque os pads ou use a √°rea central (XY) para manipular tom e timbre. Suporte para toque e mouse.</div>
      <hr style="margin:12px 0;border-color:rgba(255,255,255,0.03)" />

      <div class="pad-section">
        <div class="section-title">ü•Å Bateria</div>
        <div class="pads">
          <div class="pad pad-kick" data-pad="kick">KICK</div>
          <div class="pad pad-snare" data-pad="snare">SNARE</div>
          <div class="pad pad-hat" data-pad="hat">HI-HAT</div>
          <div class="pad pad-openhat" data-pad="openhat">OPEN HAT</div>
          <div class="pad pad-crash" data-pad="crash">CRASH</div>
          <div class="pad pad-ride" data-pad="ride">RIDE</div>
          <div class="pad pad-tom" data-pad="tom">TOM</div>
          <div class="pad pad-clap" data-pad="clap">CLAP</div>
          <div class="pad pad-perc" data-pad="perc">PERC</div>
        </div>
      </div>
      
      <div class="pad-section">
        <div class="section-title">üéπ Instrumentos</div>
        <div class="pads">
          <div class="pad pad-piano" data-pad="piano">PIANO</div>
          <div class="pad pad-bass" data-pad="bass">BASS</div>
          <div class="pad pad-lead" data-pad="lead">LEAD</div>
          <div class="pad pad-pad" data-pad="synthpad">PAD</div>
          <div class="pad pad-pluck" data-pad="pluck">PLUCK</div>
          <div class="pad pad-organ" data-pad="organ">ORGAN</div>
        </div>
      </div>
      
      <div class="pad-section">
        <div class="section-title">üéõÔ∏è Efeitos</div>
        <div class="pads">
          <div class="pad pad-fx" data-pad="reverse">REVERSE</div>
          <div class="pad pad-sweep" data-pad="sweep">SWEEP</div>
          <div class="pad pad-noise" data-pad="whitenoise">NOISE</div>
        </div>
      </div>

      <hr style="margin:12px 0;border-color:rgba(255,255,255,0.03)" />

      <div>
        <div style="margin-bottom:8px"><strong>Controles</strong></div>
        <div class="controls">
          <div class="row"><label>BPM</label><input id="bpm" type="range" min="40" max="200" value="100" /></div>
          <div class="row"><label>Volume Mestre</label><input id="masterVol" type="range" min="0" max="1" step="0.01" value="0.9" /></div>
          <div class="row"><label>Pitch Range</label><input id="pitchRange" type="range" min="0.2" max="3" step="0.01" value="1.5" /></div>
        </div>
        <div style="margin-top:10px;display:flex;gap:8px">
          <button id="startStop">Start</button>
          <button id="metroToggle" class="muted-btn">Metr√¥nomo</button>
          <button id="savePreset" class="muted-btn">Salvar Preset</button>
        </div>
      </div>

      <hr style="margin:12px 0;border-color:rgba(255,255,255,0.03)" />

      <div>
        <div style="margin-bottom:8px"><strong>Presets</strong></div>
        <div class="preset-list" id="presets"></div>
      </div>
    </div>

    <div class="card center">
      <h1>√Årea Central ‚Äî XY Pad (toque para controlar nota / batida)</h1>
      <canvas id="xyCanvas"></canvas>
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div class="meta">Eixo X: varia√ß√£o entre dois timbres / samples ‚Ä¢ Eixo Y: pitch/volume</div>
        <div>
          <label>Modo</label>
          <select id="mode">
            <option value="sampleBlend">Misturar Samples</option>
            <option value="oscillator">Oscilador (sintet)</option>
            <option value="drumMorph">Morph Bateria</option>
          </select>
        </div>
      </div>
    </div>
  </div>

<script>
// --- Setup WebAudio ---
const AudioContext = window.AudioContext || window.webkitAudioContext;
const ctx = new AudioContext();
let masterGain = ctx.createGain(); masterGain.gain.value = 0.9; masterGain.connect(ctx.destination);

// Basic utilities
function now(){return ctx.currentTime}

// State
const state = {
  bpm:100, playing:false, metro:false,
  pitchRange:1.5, masterVol:0.9,
  mode:'sampleBlend'
}

// Wire controls
const bpmSlider = document.getElementById('bpm');
const masterVol = document.getElementById('masterVol');
const pitchRange = document.getElementById('pitchRange');
const startStopBtn = document.getElementById('startStop');
const metroToggle = document.getElementById('metroToggle');
const xyCanvas = document.getElementById('xyCanvas');
const modeSel = document.getElementById('mode');

bpmSlider.addEventListener('input',()=>{state.bpm=+bpmSlider.value});
masterVol.addEventListener('input',()=>{state.masterVol=+masterVol.value; masterGain.gain.setValueAtTime(state.masterVol, now());});
pitchRange.addEventListener('input',()=>{state.pitchRange=+pitchRange.value});
modeSel.addEventListener('change',()=>{state.mode=modeSel.value; drawGuide();});

startStopBtn.addEventListener('click',()=>{ if(!state.playing){ startTransport(); } else { stopTransport(); } });
metroToggle.addEventListener('click',()=>{ state.metro = !state.metro; metroToggle.style.opacity = state.metro?1:0.6; });

// --- Drum pads synthesis ---
function playKick(time){
  const g = ctx.createGain(); g.gain.value = 1; g.connect(masterGain);
  const o = ctx.createOscillator(); o.type='sine'; o.frequency.setValueAtTime(150, time);
  o.frequency.exponentialRampToValueAtTime(40, time+0.5);
  g.gain.setValueAtTime(0.0001, time);
  g.gain.exponentialRampToValueAtTime(1.2, time+0.001);
  g.gain.exponentialRampToValueAtTime(0.001, time+0.6);
  o.connect(g); o.start(time); o.stop(time+0.7);
}

function playSnare(time){
  const noise = ctx.createBufferSource();
  noise.buffer = makeNoiseBuffer();
  const nFilter = ctx.createBiquadFilter(); nFilter.type='highpass'; nFilter.frequency.value = 1000;
  const g = ctx.createGain(); g.gain.value=1; g.connect(masterGain);
  noise.connect(nFilter); nFilter.connect(g);
  g.gain.setValueAtTime(1, time); g.gain.exponentialRampToValueAtTime(0.01, time+0.4);
  noise.start(time); noise.stop(time+0.5);
}

function playHat(time){
  const o = ctx.createOscillator(); o.type='square'; o.frequency.value=8000;
  const g = ctx.createGain(); g.gain.value=0.0001; g.connect(masterGain);
  o.connect(g); o.start(time);
  g.gain.setValueAtTime(0.0001, time); g.gain.exponentialRampToValueAtTime(0.6, time+0.001); g.gain.exponentialRampToValueAtTime(0.0001, time+0.12);
  o.stop(time+0.15);
}

function playOpenHat(time){
  const o = ctx.createOscillator(); o.type='square'; o.frequency.value=7000;
  const g = ctx.createGain(); g.gain.value=0.0001; g.connect(masterGain);
  o.connect(g); o.start(time);
  g.gain.setValueAtTime(0.0001, time); g.gain.exponentialRampToValueAtTime(0.4, time+0.001); g.gain.exponentialRampToValueAtTime(0.0001, time+0.3);
  o.stop(time+0.35);
}

function playCrash(time){
  const noise = ctx.createBufferSource();
  noise.buffer = makeNoiseBuffer();
  const filter = ctx.createBiquadFilter(); filter.type='highpass'; filter.frequency.value = 3000;
  const g = ctx.createGain(); g.gain.value=0.8; g.connect(masterGain);
  noise.connect(filter); filter.connect(g);
  g.gain.setValueAtTime(0.8, time); g.gain.exponentialRampToValueAtTime(0.001, time+2.0);
  noise.start(time); noise.stop(time+2.5);
}

function playRide(time){
  const o1 = ctx.createOscillator(); o1.type='triangle'; o1.frequency.value=4000;
  const o2 = ctx.createOscillator(); o2.type='sine'; o2.frequency.value=8000;
  const g = ctx.createGain(); g.gain.value=0.0001; g.connect(masterGain);
  o1.connect(g); o2.connect(g); o1.start(time); o2.start(time);
  g.gain.setValueAtTime(0.0001, time); g.gain.exponentialRampToValueAtTime(0.3, time+0.001); g.gain.exponentialRampToValueAtTime(0.0001, time+0.8);
  o1.stop(time+0.9); o2.stop(time+0.9);
}

function playTom(time){
  const o = ctx.createOscillator(); o.type='sine'; o.frequency.setValueAtTime(220, time); o.frequency.exponentialRampToValueAtTime(120, time+0.4);
  const g = ctx.createGain(); g.gain.value=1; g.connect(masterGain);
  g.gain.setValueAtTime(1, time); g.gain.exponentialRampToValueAtTime(0.001, time+0.6);
  o.connect(g); o.start(time); o.stop(time+0.8);
}

function playClap(time){
  // Multiple quick noise bursts to simulate clap
  for(let i = 0; i < 4; i++) {
    const noise = ctx.createBufferSource();
    noise.buffer = makeNoiseBuffer();
    const filter = ctx.createBiquadFilter(); filter.type='bandpass'; filter.frequency.value = 1500;
    const g = ctx.createGain(); g.gain.value=0.3; g.connect(masterGain);
    noise.connect(filter); filter.connect(g);
    const startTime = time + i * 0.01;
    g.gain.setValueAtTime(0.3, startTime); g.gain.exponentialRampToValueAtTime(0.001, startTime+0.1);
    noise.start(startTime); noise.stop(startTime+0.12);
  }
}

function playPerc(time){
  const o = ctx.createOscillator(); o.type='triangle'; o.frequency.setValueAtTime(800, time); o.frequency.exponentialRampToValueAtTime(200, time+0.2);
  const g = ctx.createGain(); g.gain.value=0.6; g.connect(masterGain);
  g.gain.setValueAtTime(0.6, time); g.gain.exponentialRampToValueAtTime(0.001, time+0.3);
  o.connect(g); o.start(time); o.stop(time+0.4);
}

// --- Melodic instruments ---
function playPiano(time, freq = 440){
  // Simple piano-like sound with multiple harmonics
  const o1 = ctx.createOscillator(); o1.type='sine'; o1.frequency.value=freq;
  const o2 = ctx.createOscillator(); o2.type='sine'; o2.frequency.value=freq*2;
  const o3 = ctx.createOscillator(); o3.type='sine'; o3.frequency.value=freq*3;
  const g1 = ctx.createGain(); g1.gain.value=0.6;
  const g2 = ctx.createGain(); g2.gain.value=0.3;
  const g3 = ctx.createGain(); g3.gain.value=0.1;
  const master = ctx.createGain(); master.connect(masterGain);
  o1.connect(g1); o2.connect(g2); o3.connect(g3);
  g1.connect(master); g2.connect(master); g3.connect(master);
  master.gain.setValueAtTime(0.7, time); master.gain.exponentialRampToValueAtTime(0.001, time+2.0);
  o1.start(time); o2.start(time); o3.start(time);
  o1.stop(time+2.5); o2.stop(time+2.5); o3.stop(time+2.5);
}

function playBass(time, freq = 110){
  const o = ctx.createOscillator(); o.type='sawtooth'; o.frequency.value=freq;
  const filter = ctx.createBiquadFilter(); filter.type='lowpass'; filter.frequency.value=800;
  const g = ctx.createGain(); g.gain.value=0.8; g.connect(masterGain);
  o.connect(filter); filter.connect(g);
  g.gain.setValueAtTime(0.8, time); g.gain.exponentialRampToValueAtTime(0.001, time+1.2);
  o.start(time); o.stop(time+1.5);
}

function playLead(time, freq = 880){
  const o = ctx.createOscillator(); o.type='sawtooth'; o.frequency.value=freq;
  const filter = ctx.createBiquadFilter(); filter.type='lowpass'; filter.frequency.value=3000;
  const g = ctx.createGain(); g.gain.value=0.6; g.connect(masterGain);
  o.connect(filter); filter.connect(g);
  g.gain.setValueAtTime(0.6, time); g.gain.exponentialRampToValueAtTime(0.001, time+1.5);
  o.start(time); o.stop(time+2.0);
}

function playSynthPad(time, freq = 220){
  const o1 = ctx.createOscillator(); o1.type='sawtooth'; o1.frequency.value=freq;
  const o2 = ctx.createOscillator(); o2.type='sawtooth'; o2.frequency.value=freq*1.5;
  const filter = ctx.createBiquadFilter(); filter.type='lowpass'; filter.frequency.value=1500;
  const g = ctx.createGain(); g.gain.value=0.4; g.connect(masterGain);
  o1.connect(filter); o2.connect(filter); filter.connect(g);
  g.gain.setValueAtTime(0.001, time); g.gain.exponentialRampToValueAtTime(0.4, time+0.3); g.gain.exponentialRampToValueAtTime(0.001, time+3.0);
  o1.start(time); o2.start(time); o1.stop(time+3.5); o2.stop(time+3.5);
}

function playPluck(time, freq = 440){
  const o = ctx.createOscillator(); o.type='triangle'; o.frequency.value=freq;
  const g = ctx.createGain(); g.gain.value=0.7; g.connect(masterGain);
  o.connect(g);
  g.gain.setValueAtTime(0.7, time); g.gain.exponentialRampToValueAtTime(0.001, time+0.8);
  o.start(time); o.stop(time+1.0);
}

function playOrgan(time, freq = 330){
  const o1 = ctx.createOscillator(); o1.type='sine'; o1.frequency.value=freq;
  const o2 = ctx.createOscillator(); o2.type='sine'; o2.frequency.value=freq*2;
  const o3 = ctx.createOscillator(); o3.type='sine'; o3.frequency.value=freq*3;
  const g = ctx.createGain(); g.gain.value=0.5; g.connect(masterGain);
  o1.connect(g); o2.connect(g); o3.connect(g);
  g.gain.setValueAtTime(0.001, time); g.gain.exponentialRampToValueAtTime(0.5, time+0.1); g.gain.exponentialRampToValueAtTime(0.001, time+2.5);
  o1.start(time); o2.start(time); o3.start(time);
  o1.stop(time+3.0); o2.stop(time+3.0); o3.stop(time+3.0);
}

// --- Effects ---
function playReverse(time){
  // Simulated reverse effect with sweep
  const o = ctx.createOscillator(); o.type='sawtooth'; o.frequency.setValueAtTime(100, time); o.frequency.exponentialRampToValueAtTime(1000, time+1.0);
  const g = ctx.createGain(); g.gain.value=0.5; g.connect(masterGain);
  o.connect(g);
  g.gain.setValueAtTime(0.001, time); g.gain.exponentialRampToValueAtTime(0.5, time+1.0); g.gain.exponentialRampToValueAtTime(0.001, time+1.2);
  o.start(time); o.stop(time+1.5);
}

function playSweep(time){
  const o = ctx.createOscillator(); o.type='sawtooth'; o.frequency.setValueAtTime(2000, time); o.frequency.exponentialRampToValueAtTime(200, time+0.8);
  const filter = ctx.createBiquadFilter(); filter.type='lowpass'; filter.frequency.setValueAtTime(4000, time); filter.frequency.exponentialRampToValueAtTime(500, time+0.8);
  const g = ctx.createGain(); g.gain.value=0.6; g.connect(masterGain);
  o.connect(filter); filter.connect(g);
  g.gain.setValueAtTime(0.6, time); g.gain.exponentialRampToValueAtTime(0.001, time+1.0);
  o.start(time); o.stop(time+1.2);
}

function playWhiteNoise(time){
  const noise = ctx.createBufferSource();
  noise.buffer = makeNoiseBuffer();
  const g = ctx.createGain(); g.gain.value=0.3; g.connect(masterGain);
  noise.connect(g);
  g.gain.setValueAtTime(0.3, time); g.gain.exponentialRampToValueAtTime(0.001, time+0.5);
  noise.start(time); noise.stop(time+0.8);
}

function makeNoiseBuffer(){
  const len = ctx.sampleRate * 1.0;
  const buf = ctx.createBuffer(1,len,ctx.sampleRate);
  const data = buf.getChannelData(0);
  for(let i=0;i<len;i++) data[i] = Math.random()*2-1;
  return buf;
}

// Hook pads UI
document.querySelectorAll('.pad').forEach(el=>{
  el.addEventListener('pointerdown',async (e)=>{ 
    await ensureResume(); 
    const p = el.dataset.pad; 
    const t = now();
    
    // Drum sounds
    if(p==='kick') playKick(t);
    else if(p==='snare') playSnare(t);
    else if(p==='hat') playHat(t);
    else if(p==='openhat') playOpenHat(t);
    else if(p==='crash') playCrash(t);
    else if(p==='ride') playRide(t);
    else if(p==='tom') playTom(t);
    else if(p==='clap') playClap(t);
    else if(p==='perc') playPerc(t);
    
    // Melodic instruments
    else if(p==='piano') playPiano(t, 440);
    else if(p==='bass') playBass(t, 110);
    else if(p==='lead') playLead(t, 880);
    else if(p==='synthpad') playSynthPad(t, 220);
    else if(p==='pluck') playPluck(t, 660);
    else if(p==='organ') playOrgan(t, 330);
    
    // Effects
    else if(p==='reverse') playReverse(t);
    else if(p==='sweep') playSweep(t);
    else if(p==='whitenoise') playWhiteNoise(t);
    
    // Visual feedback
    el.style.transform = 'scale(0.95)';
    setTimeout(() => { el.style.transform = ''; }, 100);
  });
});

// --- Transport / metronome ---
let metroInterval = null;
function startTransport(){ state.playing=true; startStopBtn.textContent='Stop'; if(state.metro) startMetro(); }
function stopTransport(){ state.playing=false; startStopBtn.textContent='Start'; stopMetro(); }
function startMetro(){ stopMetro(); const beatInterval = 60/state.bpm; metroInterval = setInterval(()=>{ const t=now()+0.02; playClick(t); }, beatInterval*1000); }
function stopMetro(){ if(metroInterval) clearInterval(metroInterval); metroInterval=null; }
function playClick(time){ const o = ctx.createOscillator(); const g = ctx.createGain(); g.connect(masterGain); o.connect(g); o.frequency.value=1200; g.gain.setValueAtTime(0.0001,time); g.gain.exponentialRampToValueAtTime(0.8,time+0.001); g.gain.exponentialRampToValueAtTime(0.0001,time+0.08); o.start(time); o.stop(time+0.1); }

// Ensure audio resume on interaction (mobile policies)
async function ensureResume(){ if(ctx.state==='suspended'){ await ctx.resume(); } }
window.addEventListener('pointerdown', ()=>{ ensureResume(); });

// --- XY Pad Implementation ---
const canvas = xyCanvas; const rect = ()=>canvas.getBoundingClientRect();
canvas.width = Math.floor(rect().width * devicePixelRatio);
canvas.height = Math.floor(rect().height * devicePixelRatio);
const g = canvas.getContext('2d'); g.scale(devicePixelRatio, devicePixelRatio);
let pointer = null; const centerA={x:80,y:80}; const centerB={x:canvas.width/devicePixelRatio-80,y:canvas.height/devicePixelRatio-80};
function drawGuide(){ g.clearRect(0,0,canvas.width/devicePixelRatio,canvas.height/devicePixelRatio);
  // gradient background
  const W = canvas.width/devicePixelRatio, H = canvas.height/devicePixelRatio;
  const grd = g.createLinearGradient(0,0,W,H); grd.addColorStop(0,'rgba(31,182,255,0.06)'); grd.addColorStop(1,'rgba(255,255,255,0.02)');
  g.fillStyle = grd; g.fillRect(0,0,W,H);
  // draw points A and B
  g.fillStyle='rgba(255,255,255,0.06)'; g.beginPath(); g.arc(centerA.x,centerA.y,12,0,Math.PI*2); g.fill();
  g.beginPath(); g.arc(centerB.x,centerB.y,12,0,Math.PI*2); g.fill();
  // line between
  g.strokeStyle='rgba(255,255,255,0.04)'; g.lineWidth=2; g.beginPath(); g.moveTo(centerA.x,centerA.y); g.lineTo(centerB.x,centerB.y); g.stroke();
  // pointer
  if(pointer){ g.fillStyle='rgba(31,182,255,0.9)'; g.beginPath(); g.arc(pointer.x,pointer.y,10,0,Math.PI*2); g.fill(); }
}

drawGuide();

function interp(a,b,t){return a+(b-a)*t}

async function handlePointer(x,y){ await ensureResume(); pointer = {x,y}; drawGuide();
  // compute t along line A->B projection
  const ax=centerA.x, ay=centerA.y, bx=centerB.x, by=centerB.y;
  const vx = bx-ax, vy = by-ay; const wx = x-ax, wy = y-ay;
  const vlen2 = vx*vx+vy*vy; let t = 0; if(vlen2>0) t = Math.max(0, Math.min(1, (vx*wx + vy*wy)/vlen2));
  // vertical influence (distance from line) -> map to pitch or volume
  const projx = interp(ax,bx,t), projy = interp(ay,by,t);
  const dist = Math.hypot(x-projx, y-projy);
  const maxDist = Math.min(canvas.width/devicePixelRatio, canvas.height/devicePixelRatio)/2;
  const yInfluence = 1 - Math.min(1, dist/maxDist);

  // Depending on mode, trigger appropriate sound
  if(state.mode==='oscillator'){
    playXYOsc(t, yInfluence);
  } else if(state.mode==='sampleBlend'){
    playBlendSample(t, yInfluence);
  } else if(state.mode==='drumMorph'){
    playMorphDrum(t, yInfluence);
  }
}

// --- XY mode implementations ---
function playXYOsc(t,yInf){
  const baseFreq = 220; // A3
  const freq = baseFreq * Math.pow(2, (t-0.5)*state.pitchRange);
  const o = ctx.createOscillator(); o.type='sawtooth'; o.frequency.value=freq;
  const g = ctx.createGain(); g.gain.value = yInf*0.6; g.connect(masterGain);
  // simple filter varying with t
  const f = ctx.createBiquadFilter(); f.type='lowpass'; f.frequency.value = interp(500,5000,t);
  o.connect(f); f.connect(g);
  o.start(); o.stop(now()+0.6);
}

function playBlendSample(t,yInf){
  // we synthesize two simple timbres and blend between them
  // timbreA = sine, timbreB = square
  const baseFreq = 440 * Math.pow(2,(t-0.5)*state.pitchRange);
  const a = ctx.createOscillator(); a.type='sine'; a.frequency.value=baseFreq;
  const b = ctx.createOscillator(); b.type='square'; b.frequency.value=baseFreq;
  const gA = ctx.createGain(); const gB = ctx.createGain(); gA.connect(masterGain); gB.connect(masterGain);
  gA.gain.value = 1-t; gB.gain.value = t;
  const env = ctx.createGain(); env.connect(masterGain);
  a.connect(gA); b.connect(gB);
  gA.connect(env); gB.connect(env);
  env.gain.setValueAtTime(yInf,now()); env.gain.exponentialRampToValueAtTime(0.001, now()+0.7);
  a.start(); b.start(); a.stop(now()+0.7); b.stop(now()+0.7);
}

function playMorphDrum(t,yInf){
  // choose mix between kick and snare
  const time = now();
  if(t<0.4){ playKick(time); }
  else if(t<0.7){ playTom(time); }
  else { playSnare(time); }
}

// Pointer events
let isDown=false;
function getXYFromEvent(e){ const r=rect(); const x = (e.clientX||e.touches[0].clientX) - r.left; const y = (e.clientY||e.touches[0].clientY) - r.top; return {x,y}; }
canvas.addEventListener('pointerdown',(ev)=>{ isDown=true; const p=getXYFromEvent(ev); handlePointer(p.x,p.y); });
canvas.addEventListener('pointermove',(ev)=>{ if(!isDown) return; const p=getXYFromEvent(ev); handlePointer(p.x,p.y); });
canvas.addEventListener('pointerup',(ev)=>{ isDown=false; pointer=null; drawGuide(); });
canvas.addEventListener('pointercancel',(ev)=>{ isDown=false; pointer=null; drawGuide(); });

// Resize handling
window.addEventListener('resize',()=>{ canvas.width = Math.floor(rect().width * devicePixelRatio); canvas.height = Math.floor(rect().height * devicePixelRatio); g.scale(devicePixelRatio,devicePixelRatio); centerB.x = canvas.width/devicePixelRatio-80; centerB.y = canvas.height/devicePixelRatio-80; drawGuide(); });

// Presets (localStorage)
function savePreset(){ const p = {bpm:state.bpm, pitchRange:state.pitchRange, masterVol:state.masterVol, mode:state.mode}; const arr = JSON.parse(localStorage.getItem('sint_presets')||'[]'); arr.push(p); localStorage.setItem('sint_presets', JSON.stringify(arr)); renderPresets(); }
function renderPresets(){ const list = document.getElementById('presets'); list.innerHTML=''; const arr = JSON.parse(localStorage.getItem('sint_presets')||'[]'); arr.forEach((pr,i)=>{ const el=document.createElement('div'); el.className='preset'; el.textContent=`Preset ${i+1} (BPM ${pr.bpm})`; el.addEventListener('click',()=>{ state.bpm=pr.bpm; bpmSlider.value=pr.bpm; state.pitchRange=pr.pitchRange; pitchRange.value=pr.pitchRange; state.masterVol=pr.masterVol; masterVol.value=pr.masterVol; state.mode=pr.mode; modeSel.value=pr.mode; }); list.appendChild(el); }); }

document.getElementById('savePreset').addEventListener('click',savePreset);
renderPresets();

// Utility: resume audio on first gesture
window.addEventListener('pointerdown',()=>{ if(ctx.state==='suspended') ctx.resume(); });

// Final note: friendly help
console.log('üéµ Pad Musical Completo carregado! üéµ');
console.log('- 9 sons de bateria coloridos');
console.log('- 6 instrumentos mel√≥dicos');
console.log('- 3 efeitos sonoros');
console.log('- √Årea XY para controle em tempo real');
console.log('Divirta-se criando m√∫sica! üé∂');
</script>
</body>
</html>
